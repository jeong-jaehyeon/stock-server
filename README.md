# ğŸ“ˆ Stock Portfolio API (ì£¼ì‹ í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬ ì„œë¹„ìŠ¤)

ì´ í”„ë¡œì íŠ¸ëŠ” ì‚¬ìš©ìê°€ ìì‹ ì˜ **ì£¼ì‹ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ê´€ë¦¬**í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.  
Twelve Data APIë¥¼ í™œìš©í•˜ì—¬ **ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„° ì¡°íšŒ ë° í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“Œ 1. í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡ íŠ¸ì—”ë“œ**: ì¶”í›„ êµ¬í˜„ ì˜ˆì •
- **ë°±ì—”ë“œ**: Express.js + TypeScript
- **ë°ì´í„°ë² ì´ìŠ¤**: MariaDB + Sequelize
- **API ì œê³µ**: Twelve Data API ì‚¬ìš©

---

## ğŸ“Œ 2. í”„ë¡œì íŠ¸ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1ï¸âƒ£ í”„ë¡œì íŠ¸ í´ë¡  ë° í™˜ê²½ ì„¤ì •
```bash
git clone https://github.com/wolgus104@naver.com/stock-server.git
cd stock-server
yarn install
```

### 2ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`.env` íŒŒì¼)
`.env` íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„± í›„, ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€:
```env
PORT=3000
DATABASE_USER=root
DATABASE_PASSWORD=yourpassword
DATABASE_NAME=stock_db
DATABASE_HOST=localhost
DATABASE_DIALECT=mariadb
TWELVE_DATA_API_KEY=your_api_key
```

### 3ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
```bash
yarn db:migrate
```

### 4ï¸âƒ£ ì„œë²„ ì‹¤í–‰
```bash
yarn dev
```

---

## ğŸ“Œ 3. API ì‚¬ìš©ë²•

### **1ï¸âƒ£ ì£¼ì‹ ê²€ìƒ‰ (ì‹¤ì‹œê°„ ì‹œì„¸ ì¡°íšŒ)**
ğŸ“Œ íŠ¹ì • ì£¼ì‹ì˜ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
```http
GET /api/stocks?symbol=AAPL
```
ğŸ“Œ **ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "symbol": "AAPL",
  "name": "Apple Inc.",
  "price": 150.50,
  "currency": "USD",
  "exchange": "NASDAQ"
}
```

---

### **2ï¸âƒ£ í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ê°€ (ë§¤ìˆ˜)**
ğŸ“Œ ì‚¬ìš©ìì˜ í¬íŠ¸í´ë¦¬ì˜¤ì— ì£¼ì‹ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
```http
POST /api/portfolio
```
ğŸ“Œ **ìš”ì²­ ë°”ë””**
```json
{
  "symbol": "AAPL",
  "buyPrice": 150.5,
  "quantity": 10
}
```
ğŸ“Œ **ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "id": 1,
  "symbol": "AAPL",
  "buyPrice": 150.5,
  "quantity": 10,
  "createdAt": "2024-02-10T12:00:00Z"
}
```

âœ… **ê¸°ëŠ¥ ì„¤ëª…**
- ê°™ì€ ì£¼ì‹ì„ **ì¤‘ë³µ ì¶”ê°€í•˜ë©´ í‰ê·  ë§¤ìˆ˜ ë‹¨ê°€ ì¡°ì •**
- ê¸°ì¡´ ë³´ìœ  ì£¼ì‹ ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸
- ê±°ë˜ ë‚´ì—­(`trade_history`) í…Œì´ë¸”ì— `BUY` ê¸°ë¡ ì¶”ê°€ë¨

---

### **3ï¸âƒ£ í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ**
ğŸ“Œ ì‚¬ìš©ìì˜ í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
```http
GET /api/portfolio
```
ğŸ“Œ **ì‘ë‹µ ì˜ˆì‹œ**
```json
[
  {
    "symbol": "AAPL",
    "name": "Apple Inc.",
    "quantity": 10,
    "buyPrice": 150.5,
    "currentPrice": 155.0,
    "profitLoss": 4.5
  }
]
```

âœ… **ê¸°ëŠ¥ ì„¤ëª…**
- í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ì˜ **ë³´ìœ  ì£¼ì‹ ëª©ë¡, ìˆ˜ëŸ‰, í‰ê·  ë§¤ìˆ˜ ë‹¨ê°€ ì¡°íšŒ**
- í˜„ì¬ê°€(`currentPrice`)ì™€ **ìˆ˜ìµë¥ (`profitLoss`) ê³„ì‚°í•˜ì—¬ ì œê³µ**

---

### **4ï¸âƒ£ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì£¼ì‹ ë§¤ë„**
ğŸ“Œ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ íŠ¹ì • ì£¼ì‹ì„ ë§¤ë„í•©ë‹ˆë‹¤.
```http
POST /api/portfolio/sell/AAPL
```
ğŸ“Œ **ìš”ì²­ ë°”ë””**
```json
{
  "sellPrice": 160,
  "quantity": 5
}
```
ğŸ“Œ **ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "message": "AAPL ì£¼ì‹ì„ 5ê°œ ë§¤ë„ ì™„ë£Œ.",
  "remainingQuantity": 5,
  "profitLoss": 50
}
```

âœ… **ê¸°ëŠ¥ ì„¤ëª…**
- ë³´ìœ  ì£¼ì‹ì˜ ì¼ë¶€ë§Œ ë§¤ë„í•  ê²½ìš°, **ë‚¨ì€ ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸**
- **ì „ëŸ‰ ë§¤ë„ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì‚­ì œ**
- ê±°ë˜ ë‚´ì—­(`trade_history`) í…Œì´ë¸”ì— `SELL` ê¸°ë¡ ì¶”ê°€ë¨
- ë§¤ë„ ì‹œ ë°œìƒí•œ ìˆ˜ìµ/ì†ì‹¤(`profitLoss`) ê³„ì‚°ë¨

---

### **5ï¸âƒ£ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì£¼ì‹ ì‚­ì œ**
ğŸ“Œ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ íŠ¹ì • ì£¼ì‹ì„ ì™„ì „íˆ ì œê±°í•©ë‹ˆë‹¤.
```http
DELETE /api/portfolio/AAPL
```
ğŸ“Œ **ì‘ë‹µ ì˜ˆì‹œ**
```json
{
  "message": "AAPL removed from portfolio"
}
```

âœ… **ê¸°ëŠ¥ ì„¤ëª…**
- í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ **í•´ë‹¹ ì£¼ì‹ì„ ì™„ì „íˆ ì‚­ì œ**
- ê±°ë˜ ë‚´ì—­(`trade_history`)ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ

---

## ğŸ“Œ 4. í˜„ì¬ê¹Œì§€ ì§„í–‰í•œ ì‘ì—…
âœ… Express + TypeScript + Sequelize ì´ˆê¸° ì„¤ì • ì™„ë£Œ  
âœ… MariaDB ì—°ê²° ë° `stock_db` ìƒì„±  
âœ… Twelve Data API ì—°ë™í•˜ì—¬ ì£¼ì‹ ë°ì´í„° ì¡°íšŒ êµ¬í˜„  
âœ… í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± (`portfolio`)  
âœ… í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ê°€ (`POST /api/portfolio`) ê¸°ëŠ¥ êµ¬í˜„  
âœ… í¬íŠ¸í´ë¦¬ì˜¤ ì‚­ì œ (`DELETE /api/portfolio/:symbol`) API êµ¬í˜„  
âœ… í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ (`GET /api/portfolio`) API êµ¬í˜„  
âœ… ë§¤ë„ ê¸°ëŠ¥ (`POST /api/portfolio/sell/:symbol`) êµ¬í˜„ ì™„ë£Œ  
âœ… `trade_history` í…Œì´ë¸” ì¶”ê°€ ë° **ë§¤ìˆ˜/ë§¤ë„ ë‚´ì—­ ê¸°ë¡ ê¸°ëŠ¥ ë°˜ì˜**  
âœ… `profitLoss`(ìˆ˜ìµ/ì†ì‹¤) ê³„ì‚° ê¸°ëŠ¥ ì¶”ê°€

---

## ğŸ“Œ 5. ì•ìœ¼ë¡œ í•  ì‘ì—…
ğŸ”œ í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ê°€ ì‹œ, **ì¤‘ë³µ ì£¼ì‹ ì²˜ë¦¬ ë° í‰ê·  ë§¤ìˆ˜ê°€ ê³„ì‚°**  
ğŸ”œ í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ ì‹œ, **í˜„ì¬ ì£¼ê°€ ë° ì†ìµë¥  ê³„ì‚° ì¶”ê°€**  
ğŸ”œ í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€ (ë§¤ìˆ˜ ë‹¨ê°€ ë³€ê²½ ê°€ëŠ¥í•˜ê²Œ)  
ğŸ”œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì‹œì‘ (ì¶”í›„ ì§„í–‰)  
ğŸ”œ Postman ë§í¬ ì¶”ê°€ ì˜ˆì •

---

## ğŸ“Œ 6. API í…ŒìŠ¤íŠ¸ (Postman)
Postmanìœ¼ë¡œ APIë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ“Œ **Postman ë§í¬ ì¶”ê°€ ì˜ˆì •**

---

## ğŸ“Œ 7. ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„  (2024-04-04)

- âœ… `express-async-errors` ì ìš©  
  - ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ê°€ ìë™ìœ¼ë¡œ `Express`ì˜ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¡œ ì „ë‹¬ë¨.  
  - `try-catch`ë¥¼ ì¼ì¼ì´ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ì½”ë“œê°€ ê¹”ë”í•´ì§.

- âœ… `http-errors` ì ìš©  
  - ëª…í™•í•˜ê³  ì¼ê´€ëœ ì—ëŸ¬ ë©”ì‹œì§€ì™€ HTTP ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ë„ë¡ ê°œì„ .  
  - ì˜ˆì‹œ:
    ```ts
    import createError from "http-errors"

    if (!symbol) {
      throw createError(400, "symbolì€ í•„ìˆ˜ ì…ë ¥ê°’ì…ë‹ˆë‹¤.")
    }
    ```

- âœ… ê°œì„ ëœ ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì˜ˆì‹œ
    ```ts
    app.use((err: HttpError, req: Request, res: Response, _next: NextFunction) => {
      console.error(err.stack)
      res.status(err.status || 500).json({
        message: err.message || "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      })
    })
    ```

---

## ğŸ“Œ 8. ê¸°íƒ€
- **ë¬¸ì˜:** `wolgus104@naver.com`
- **API ë¬¸ì„œ:** Postman ë§í¬ ì¶”ê°€ ì˜ˆì •
